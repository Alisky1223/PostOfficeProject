@page "/AddPostOffice"
@using MudBlazor
@using System.Net.Http.Json
@using System.Globalization
@using System.Reflection
@using System.Threading
@using System.Diagnostics.Metrics
@using PostOfficeFrontendProject__all_interactive.Interface
@using PostOfficeProject.Core.src.Application.Dto
@inject HttpClient httpClient
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar
@inject IDialogService DialogService
@inject IPostOfficeMiddelware postOfficeMiddelware

    <MudForm @ref="form">

        <MudItem Class="d-flex align-center justify-center mud-theme-primary mud-elevation-25" Style="height:60px; width:100%; margin-top:0px; margin-bottom:20px;">
          
            <MudText Typo="Typo.h5">Add PostOffice</MudText>
       
        </MudItem>

        <MudPaper Class="d-flex flex-wrap align-start justify-center gap-4" Elevation="25">

            <MudPaper Width="100%" Class="d-flex align-center justify-center flex-grow-1 gap-4" Style="margin-bottom:20px;padding:20px" Elevation="0">
            
                <MudItem Style="width:20%">
                 
                    <MudTextField @bind-Value="addOffice.OfficeAccessCode" Label="OfficeAccessCode" Variant="Variant.Outlined" Immediate="true" Required></MudTextField>
             
                </MudItem>

                <MudItem Style="width:20%">
                  
                    <MudTextField @bind-Value="addOffice.OfficeName" Label="OfficeName" Variant="Variant.Outlined" Immediate="true" Required></MudTextField>
               
                </MudItem>

                <MudItem Style="width:20%">

                    <MudTextField @bind-Value="addOffice.Address" Label="Address" Variant="Variant.Outlined" Immediate="true" Required></MudTextField>

                </MudItem>

                <MudItem Style="width:20%">

                    <MudTextField @bind-Value="addOffice.StorageCapacity" Label="StorageCapacity" Variant="Variant.Outlined" Immediate="true" Required></MudTextField>

                </MudItem>

            </MudPaper>

        </MudPaper>

    </MudForm>

<MudPaper Elevation="0" Class="d-flex align-center" Style="margin-top:20px">

        <MudButton Style="margin-right:20px" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large" OnClick="AddCorreector">Save</MudButton>

        <MudButton Variant="Variant.Filled" Color="Color.Secondary" Size="Size.Large" OnClick="CanceleOpration">Cancel</MudButton>

        <MudButton Class="main-button" Variant="Variant.Filled" Color="Color.Tertiary" Size="Size.Large" OnClick="GoToMainPage">MainPage</MudButton>

    </MudPaper>

<style>

    .main-button {
        position: fixed;
        right: 15px;
    }

</style>

@code {

    #region Props

    private MudForm form;

    private PostOfficeDto addOffice = new PostOfficeDto();

    #endregion

    #region SubmitOrCancele

    private async Task AddCorreector()
    {
        await form.Validate();

        if (form.IsValid)
        {
            var create = new PostOfficeUpdateAndCreateDto
                {
                    OfficeAccessCode = addOffice.OfficeAccessCode,
                    OfficeName = addOffice.OfficeName,
                    Address = addOffice.Address,
                    StorageCapacity = addOffice.StorageCapacity,
                };

            await postOfficeMiddelware.CreatePostOfficeAsync(create);

            Snackbar.Add("Changes Saved.", Severity.Success);

            NavigationManager.NavigateTo("/PostOffice");
        }
        else
        {
            Snackbar.Add("Please Fill The Necessary field", Severity.Error);
        }

    }

    private void CanceleOpration()
    {

        NavigationManager.NavigateTo("/PostOffice");

    }

    #endregion

    #region GoToMainPage

    private void GoToMainPage()
    {

        NavigationManager.NavigateTo("/");

    }

    #endregion

}

